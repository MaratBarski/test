<md-page-title>
    <div class="page-header__content">
        <h1>OUTPUT HISTORY REPORT</h1>
    </div>
</md-page-title>
<md-page-body>
    <div class="admin-table-wrap__action">
        <div class="admin-table-wrap__col">
            <mdc-download #downloader (onBeforeDownload)="changeFileName()" [fileName]="downloadFileName"
                (click)="changeFileName()" text="Download Report"></mdc-download>
        </div>
        <div class="admin-table-wrap__col">
            <div class="tabs-page">
                <mdc-date-filter #dateFilter (onFilter)="dateFilterData($event)" [dataSource]="reports"
                    [items]="dateRanges"></mdc-date-filter>
            </div>
            <form class="form-search d-none d-md-block">
                <mdc-auto-search pause="500" #search placeholder="{{'search'|translate}}"></mdc-auto-search>
            </form>
        </div>
    </div>
    <mdc-table [auto]="true" [rowInfoTemplate]="rowInfoTemplate" [emptyState]="emptyState" #table
        [headersTemplate]="{ data:dataHeader}"
        [cellsTemplate]="{ insertDate:dateColumn, status:statusTemplate, name:nameTemplate, download:downloadTemplate}"
        [searchOptions]="searchOptions" [paginator]="paginator" [search]="search" [dataSource]="dataSource"
        [downloader]="downloader">
    </mdc-table>
    <div class="pager-wrap">
        <mdc-paginator #paginator paginationTitle="{{'paginationTitle'|translate}}" noPagingTitle="Showing {0} files"
            [blockSize]="3" [pageSize]="12" [currentPage]="0">
        </mdc-paginator>
    </div>
</md-page-body>

<ng-template #rowInfoTemplate let-item>
    <div class="category-info-row">
        <md-history-info (onClose)="closeCategoryInfo()" [category]="item.source"></md-history-info>
    </div>
</ng-template>
<ng-template #dateColumn let-item let-src="source">
    <span class="pointer link">{{item.insertDate|date}}</span>
</ng-template>
<ng-template #dataHeader>
    <span>Data </span>
    <svg width="15" height="15" mdcSvg="ic-help" color="blue"></svg>
</ng-template>
<ng-template let-item #statusTemplate let-src="source">
    <div *ngIf="src.transStatus" [stickyToElement]="true" [position]="'right'"
        [mdcTooltip]="'File generated successfully'">
        <svg width="20" height="20" mdcSvg="ic-success" color="green"></svg>
    </div>
    <div *ngIf="!src.transStatus" [stickyToElement]="true" [position]="'left'" [mdcTooltip]="item.failureToolTip">
        <svg width="20" height="20" mdcSvg="ic-failure" color="red"></svg>
    </div>
</ng-template>
<ng-template let-item #downloadTemplate let-src="source">
    <!-- <span (click)="downloadClick(item,src,$event)" class="admin-table-action__menu ic-hover"> -->
    <ng-container *ngIf="src.active||true">
        <svg  (click)="downloadClick(item,src,$event)"  width="30" height="30" mdcSvg="ic-download" color="gray"></svg>
        <!-- <a href="{{downloadUrl}}{{src.sessionHistoryId}}" [stickyToElement]="true" [position]="'left'"
            [mdcTooltip]="'Download output file'">
            <svg width="30" height="30" mdcSvg="ic-download" color="gray"></svg>
        </a> -->
    </ng-container>
    <!-- </span> -->
</ng-template>

<ng-template let-item #nameTemplate let-src="source">
    <div class="table-file-info" *ngIf="src.sessionId">
        <span class="table-file-info__name">
            {{src.sessionName}}
        </span>&nbsp;|&nbsp;
        <a class="file-count" target="_blank" href="/datalake/#/projects/{{src.projectId}}/sessions/{{src.sessionId}}">
            <span class="file-count__val">{{src.sessionId}}</span>
            <svg style="vertical-align: middle;" width="17" height="17" class="ic-external-link"
                mdcSvg="ic-external-link" color="#0596ff"></svg>
        </a>
    </div>
    <div class="table-file-info" *ngIf="!src.sessionId">
        {{src.fileNameAlias}}
    </div>

    <!-- <div class="table-file-info"><span class="table-file-info__name">d-Stroke for a long
            description...</span>&nbsp;|&nbsp;<a class="file-count" href="#"><span class="file-count__val">1233</span>
            <svg mdcSvg="ic-external-link" class="icon ic-external-link">
            </svg></a>
    </div>  -->
</ng-template>